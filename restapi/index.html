<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>PHP REST API CRUD Full</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-100 font-sans">
    <div class="container mx-auto py-8 px-4">
        <h2 class="text-3xl font-bold text-center text-purple-800 mb-6">PHP REST API CRUD Full</h2>

        <!-- Form + Search -->
        <div class="bg-white shadow-md rounded-lg p-6 mb-6 flex flex-wrap gap-4 items-end">
            <div class="flex flex-col">
                <label class="text-sm font-medium text-gray-700">Name</label>
                <input type="text" id="name" class="border rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-purple-500">
                <div class="text-red-600 text-xs mt-1" id="error-name"></div>
            </div>
            <div class="flex flex-col">
                <label class="text-sm font-medium text-gray-700">City</label>
                <input type="text" id="city" class="border rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-purple-500">
                <div class="text-red-600 text-xs mt-1" id="error-city"></div>
            </div>
            <div class="flex flex-col">
                <label class="text-sm font-medium text-gray-700">Course</label>
                <input type="text" id="course" class="border rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-purple-500">
                <div class="text-red-600 text-xs mt-1" id="error-course"></div>
            </div>
            <div class="flex flex-col">
                <label class="text-sm font-medium text-gray-700">Batch</label>
                <input type="text" id="batch" class="border rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-purple-500">
                <div class="text-red-600 text-xs mt-1" id="error-batch"></div>
            </div>
            <div class="flex flex-col">
                <label class="text-sm font-medium text-gray-700">Year</label>
                <input type="number" id="year" class="border rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-purple-500">
                <div class="text-red-600 text-xs mt-1" id="error-year"></div>
            </div>
            <div class="flex flex-col">
                <label class="text-sm font-medium text-gray-700">Age</label>
                <input type="number" id="age" class="border rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-purple-500">
                <div class="text-red-600 text-xs mt-1" id="error-age"></div>
            </div>
            <div class="flex flex-col">
                <label class="text-sm font-medium text-gray-700">DOB</label>
                <input type="date" id="dob" class="border rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-purple-500">
                <div class="text-red-600 text-xs mt-1" id="error-dob"></div>
            </div>
            <button type="button" id="save-btn" class="bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700 transition">Save</button>
            <div class="ml-auto flex flex-col">
                <label class="text-sm font-medium text-gray-700">Search</label>
                <input type="text" placeholder="Search..." id="search-input" class="border rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-purple-500">
            </div>
        </div>

        <!-- Table -->
        <div class="overflow-x-auto bg-white shadow-md rounded-lg">
            <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-purple-600 text-white">
                    <tr>
                        <th class="px-4 py-2 cursor-pointer" data-column="id">Id</th>
                        <th class="px-4 py-2 cursor-pointer" data-column="name">Name</th>
                        <th class="px-4 py-2 cursor-pointer" data-column="city">City</th>
                        <th class="px-4 py-2 cursor-pointer" data-column="course">Course</th>
                        <th class="px-4 py-2 cursor-pointer" data-column="batch">Batch</th>
                        <th class="px-4 py-2 cursor-pointer" data-column="year">Year</th>
                        <th class="px-4 py-2 cursor-pointer" data-column="age">Age</th>
                        <th class="px-4 py-2 cursor-pointer" data-column="dob">DOB</th>
                        <th class="px-4 py-2">Edit</th>
                        <th class="px-4 py-2">Delete</th>
                    </tr>
                </thead>
                <tbody id="tbody" class="divide-y divide-gray-200"></tbody>
            </table>
        </div>

        <!-- Pagination -->
        <div id="pagination" class="mt-4 flex justify-center gap-2"></div>

        <!-- Messages -->
        <div id="error-message" class="fixed top-4 right-4 p-4 bg-red-100 text-red-700 rounded shadow hidden"></div>
        <div id="success-message" class="fixed top-4 right-4 p-4 bg-green-100 text-green-700 rounded shadow hidden"></div>
    </div>

    <!-- Edit Modal -->
    <div id="modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden">
        <div id="modal-form" class="bg-white rounded-lg shadow-lg w-96 p-6 relative">
            <h2 class="text-xl font-bold mb-4">Edit Form</h2>
            <form id="edit-form" class="space-y-2">
                <div>
                    <label class="text-sm font-medium text-gray-700">Name</label>
                    <input type="text" id="edit-name" class="border rounded px-3 py-2 w-full">
                    <input type="hidden" id="edit-id">
                    <div class="text-red-600 text-xs mt-1" id="edit-error-name"></div>
                </div>
                <div>
                    <label class="text-sm font-medium text-gray-700">City</label>
                    <input type="text" id="edit-city" class="border rounded px-3 py-2 w-full">
                    <div class="text-red-600 text-xs mt-1" id="edit-error-city"></div>
                </div>
                <div>
                    <label class="text-sm font-medium text-gray-700">Course</label>
                    <input type="text" id="edit-course" class="border rounded px-3 py-2 w-full">
                    <div class="text-red-600 text-xs mt-1" id="edit-error-course"></div>
                </div>
                <div>
                    <label class="text-sm font-medium text-gray-700">Batch</label>
                    <input type="text" id="edit-batch" class="border rounded px-3 py-2 w-full">
                    <div class="text-red-600 text-xs mt-1" id="edit-error-batch"></div>
                </div>
                <div>
                    <label class="text-sm font-medium text-gray-700">Year</label>
                    <input type="number" id="edit-year" class="border rounded px-3 py-2 w-full">
                    <div class="text-red-600 text-xs mt-1" id="edit-error-year"></div>
                </div>
                <div>
                    <label class="text-sm font-medium text-gray-700">Age</label>
                    <input type="number" id="edit-age" class="border rounded px-3 py-2 w-full">
                    <div class="text-red-600 text-xs mt-1" id="edit-error-age"></div>
                </div>
                <div>
                    <label class="text-sm font-medium text-gray-700">DOB</label>
                    <input type="date" id="edit-dob" class="border rounded px-3 py-2 w-full">
                    <div class="text-red-600 text-xs mt-1" id="edit-error-dob"></div>
                </div>
                <button type="button" id="edit-submit" class="mt-2 bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700 transition">Update</button>
            </form>
            <div id="close-btn" class="absolute top-2 right-2 text-red-500 cursor-pointer font-bold">X</div>
        </div>
    </div>

    <!-- Delete Modal -->
    <div id="delete-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden">
        <div class="bg-white rounded-lg shadow-lg p-6 w-80 relative text-center">
            <h3 class="text-lg font-bold mb-4">Are you sure you want to delete?</h3>
            <input type="hidden" id="delete-id">
            <div class="flex justify-center gap-4">
                <button id="confirm-delete" class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700 transition">Yes</button>
                <button id="cancel-delete" class="bg-gray-300 text-black px-4 py-2 rounded hover:bg-gray-400 transition">No</button>
            </div>
            <div id="delete-close" class="absolute top-2 right-2 text-red-500 cursor-pointer font-bold">X</div>
        </div>
    </div>

<script src="jq/jquery.js"></script>
<script>
$(document).ready(function () {
    var currentPage = 1, totalPages = 1, sortBy = 'id', order = 'asc', searchVal = '';

    function loadData() {
        $.ajax({
            url: 'read.php',
            type: 'GET',
            data: { page: currentPage, limit: 5, sort_by: sortBy, order: order, search: searchVal },
            dataType: 'json',
            success: function (res) {
                $("#tbody").empty();
                $("#pagination").empty();
                if (!res.data || res.data.length === 0) {
                    $("#tbody").append("<tr><td colspan='10' class='text-center text-red-600'>No records found</td></tr>");
                    totalPages = 1;
                } else {
                    $.each(res.data, function (i, v) {
                       $("#tbody").append("<tr>" +
    "<td class='px-4 py-2'>" + v.id + "</td>" +
    "<td class='px-4 py-2'>" + v.name + "</td>" +
    "<td class='px-4 py-2'>" + v.city + "</td>" +
    "<td class='px-4 py-2'>" + v.course + "</td>" +
    "<td class='px-4 py-2'>" + v.batch + "</td>" +
    "<td class='px-4 py-2'>" + v.year + "</td>" +
    "<td class='px-4 py-2'>" + v.age + "</td>" +
    "<td class='px-4 py-2'>" + v.dob + "</td>" +
    "<td class='px-4 py-2'><button data-id='" + v.id + "' class='btn-edit bg-green-500 text-white px-2 py-1 rounded'>Edit</button></td>" +
    "<td class='px-4 py-2'><button data-id='" + v.id + "' class='btn-delete bg-red-500 text-white px-2 py-1 rounded'>Delete</button></td>" +
    "</tr>");

                    });
                    totalPages = res.total_pages;
                    for (var p = 1; p <= totalPages; p++) {
                        $("#pagination").append("<button class='page-btn bg-purple-500 text-white px-3 py-1 rounded hover:bg-purple-600' data-page='" + p + "'>" + p + "</button>");
                    }
                }
            }
        });
    }

    loadData();

    // Pagination click
    $(document).on("click", ".page-btn", function () { currentPage = $(this).data("page"); loadData(); });

    // Sorting
    $("th[data-column]").click(function () {
        var col = $(this).data("column");
        if (sortBy === col) order = (order === 'asc') ? 'desc' : 'asc';
        else { sortBy = col; order = 'asc'; }
        loadData();
    });

    // Form validation
    function validateForm(prefix) {
        var hasError = false;
        var fields = ['name','city','course','batch','year','age','dob'];
        $.each(fields, function(i,f){
            var val = $("#" + prefix + f).val().trim();
            if(!val){ $("#" + prefix + "error-" + f).text(f.charAt(0).toUpperCase() + f.slice(1) + " is required"); hasError = true; }
            else{ $("#" + prefix + "error-" + f).text(''); }
        });
        return !hasError;
    }

    // Auto-calc age
    $("#dob").change(function(){
        var dob = $(this).val();
        if(dob){ $("#age").val(new Date().getFullYear() - new Date(dob).getFullYear()); }
    });

    // Save
    $("#save-btn").click(function(){
        if(!validateForm('')) return;
        var data={ sname: $("#name").val(), scity: $("#city").val(), scourse: $("#course").val(), sbatch: $("#batch").val(), syear: $("#year").val(), sage: $("#age").val(), sdob: $("#dob").val() };
        $.ajax({ url:'insert.php', type:'POST', contentType:'application/json', data:JSON.stringify(data),
            success:function(res){ if(res.success){ showMessage(res.message,true); loadData(); } else { showMessage(res.message,false); } }
        });
    });

    // Edit modal
    $(document).on("click",".btn-edit",function(){
        var row=$(this).closest("tr");
        $("#edit-id").val($(this).data("id"));
        $("#edit-name").val(row.find("td:eq(1)").text());
        $("#edit-city").val(row.find("td:eq(2)").text());
        $("#edit-course").val(row.find("td:eq(3)").text());
        $("#edit-batch").val(row.find("td:eq(4)").text());
        $("#edit-year").val(row.find("td:eq(5)").text());
        $("#edit-age").val(row.find("td:eq(6)").text());
        $("#edit-dob").val(row.find("td:eq(7)").text());
        $("#modal").removeClass("hidden");
    });
    $("#close-btn").click(function(){ $("#modal").addClass("hidden"); });

    $("#edit-submit").click(function(){
        if(!validateForm('edit-')) return;
        var data={ sid: $("#edit-id").val(), sname: $("#edit-name").val(), scity: $("#edit-city").val(), scourse: $("#edit-course").val(), sbatch: $("#edit-batch").val(), syear: $("#edit-year").val(), sage: $("#edit-age").val(), sdob: $("#edit-dob").val() };
        $.ajax({ url:'update.php', type:'POST', contentType:'application/json', data:JSON.stringify(data),
            success:function(res){ if(res.success){ showMessage(res.message,true); $("#modal").addClass("hidden"); loadData(); } else { showMessage(res.message,false); } }
        });
    });

    // Delete modal
    $(document).on("click",".btn-delete",function(){ $("#delete-id").val($(this).data("id")); $("#delete-modal").removeClass("hidden"); });
    $("#cancel-delete,#delete-close").click(function(){ $("#delete-modal").addClass("hidden"); });
    $("#confirm-delete").click(function(){
        var id=$("#delete-id").val();
        $.ajax({ url:'delete.php', type:'POST', contentType:'application/json', data:JSON.stringify({sid:id}),
            success:function(res){ if(res.success){ showMessage(res.message,true); $("#delete-modal").addClass("hidden"); loadData(); } else { showMessage(res.message,false); } }
        });
    });

    // Search
    $("#search-input").on("keyup", function(){ searchVal=$(this).val().trim(); currentPage=1; loadData(); });

  // Toast messages with fade/slide animation
function showMessage(msg, success){
    var el = success ? $("#success-message") : $("#error-message");
    el.text(msg)
      .removeClass("hidden opacity-0 translate-x-10")
      .addClass("opacity-100 translate-x-0 transition duration-500 ease-out");

    setTimeout(function(){
        el.addClass("opacity-0 translate-x-10");
        setTimeout(() => el.addClass("hidden"), 500); // wait for fade-out
    },3000);
}

});
</script>

</body>
</html>
